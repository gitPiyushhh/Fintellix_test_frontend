<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Category Management</title>

    <!-- Icons -->
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&family=Open+Sans:ital,wght@0,300;0,400;0,500;1,300;1,600&display=swap"
      rel="stylesheet"
    />

    <!-- Kendo UI CSS -->

    <script type="text/javascript" src="lib/jquery.min.js"></script>

    <script type="text/javascript" src="lib/jquery.js"></script>
    <script src=".//js/components/questions.js"></script>

    <!-- <script type="text/javascript" src="lib/select2.js"></script> -->

    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="lib/jquery-ui.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="lib/jquery-ui.min.css"
    />

    <!--Kendo-->

    <link
      rel="stylesheet"
      type="text/css"
      href="lib/kendo.default-v2.min.css"
    />

    <script type="text/javascript" src="./lib/kendo.all.min.js"></script>

    <link
      rel="stylesheet"
      type="text/css"
      href="css\font-awesome-4.7.0\css\font-awesome.min.css"
    />

    <!-- <link rel="stylesheet" type="text/css" href="css/font-awesome.css" />  -->

    <link rel="stylesheet" href="./css/addQuestion.css" />
    <link rel="stylesheet" href="./css/createUser.css" />
    <link rel="stylesheet" href="./css/navbar.css" />
    <link rel="stylesheet" href="./css/ulitlities.css" />
    <link rel="stylesheet" href="./css/form.css" />
    <link rel="stylesheet" href="./css/popup.css" />
    <link rel="stylesheet" href="./css/questionsCustom.css" />
    <link rel="stylesheet" href="./css/exam.css" />
    <link rel="stylesheet" href="./css/scrollbar.css" />

    <script type="text/javascript" src="questionSection.js"></script>
  </head>
  <body>
    <div class="overlay u-display-none" id="overlay__exams">
      <div
        id="questionPopup"
        class="popup"
        style="transform: translateY(-15px)"
      >
        <div class="popup__content">
          <span
            id="closeChoseOverlay__exam"
            class="popup__icon"
            style="float: right; cursor: pointer"
            >&times;</span
          >

          <h3 class="popup__title">Available sections</h3>

          <div id="midGrid__exam" class="popup__content"></div>

          <div class="u-flex" style="justify-content: center;">
            <button
              class="popup__button"
              style="margin-top: 1.6rem; padding: 0.7rem 1.5rem"
              id="popup__button"
            >
              Done
            </button>
          </div>
        </div>
      </div>
    </div>

    <nav class="navbar">
      <ul class="u-flex">
        <a class="logo" href="./index.html" style="cursor: pointer">
          <img
            src="./../../Drawables/FIntellix Logo.svg"
            alt="Website logo"
            class="navbar__logo"
          />
        </a>
        <div class="u-flex">
          <li class="dropdown">
            <a href="#" class="dropbtn">Home</a>
          </li>
          <li class="dropdown">
            <a href="./questions.html" class="dropbtn">Questions</a>
          </li>
          <li class="dropdown">
            <a href="./categories.html" class="dropbtn">Categories</a>
          </li>
          <li>
            <a href="#" class="dropbtn" style="text-decoration: none"
              >Analytics</a
            >
          </li>

          <li>
            <a href="#" class="dropbtn" style="text-decoration: none">Exams</a>
          </li>

          <li>
            <a href="./user.html" class="dropbtn" style="text-decoration: none"
              >Users</a
            >
          </li>

          <li class="userAvatar" style="margin-left: 1rem"></li>
        </div>
      </ul>
    </nav>

    <div class="user__button">
      <div class="user__button-inner" style="justify-content: flex-end">
        <a
          class="button u-flex"
          style="
            background-color: #1a7aaf;
            justify-self: flex-end;
            padding: 0.75rem 1.5rem;
            margin-top: 0.5rem;
          "
          href="#"
          id="show__cards__exam"
        >
          Add Exam
          <iconify-icon
            icon="zondicons:add-outline"
            style="margin-left: 8px"
          ></iconify-icon>
        </a>
      </div>
    </div>

    <div id="mainContentExam"></div>

    <!-- Form -->
    <div
      class="wrapper u-display-none"
      style="margin-top: 2rem"
      id="create__new__exam"
    >
      <div class="u-flex-col" style="width: 100vw">
        <div class="user__button">
          <div class="user__button-inner" style="justify-content: flex-end">
            <a
              class="button u-flex"
              style="
                background-color: transparent;
                border: 1px solid #1a7aaf;
                color: #1a7aaf;
                justify-self: flex-end;
                padding: 0.75rem 1.5rem;
                margin-top: -2rem;
                box-shadow: none;
              "
              href="#"
              id="create__new__exam__button"
            >
              Add a new section
              <iconify-icon
                icon="zondicons:add-outline"
                style="margin-left: 8px"
              ></iconify-icon>
            </a>
          </div>
        </div>

        <div class="form-container u-flex" style="margin: 2rem auto">
          <div class="u-flex-col form__inner-container" style="width: 100%">
            <h1>Create new Exam</h1>
            <form action="#" method="post">
              <div
                class="u-flex"
                style="width: 35%; align-items: baseline; margin-top: 1rem"
              >
                <label
                  for="name"
                  style="
                    font-family: Inter;
                    font-size: 18px;
                    font-style: normal;
                    font-weight: 400;
                    line-height: 17.6px;
                  "
                  >Question name:</label
                >
                <label class="toggle" style="margin-bottom: -0.1px">
                  <input class="toggle-input" type="checkbox" />
                  <span class="toggle-label"></span>
                  <span class="toggle-handle"></span>
                </label>
              </div>

              <label for="nameExam" style="margin-top: 1.8rem"
                >Name of exam:</label
              >
              <input
                type="text"
                id="nameExam"
                name="marks"
                class="form__input-box"
                required
              />

              <label for="cheating"
                >Chances allowed if new tab opened / tab-switched:</label
              >
              <input
                type="number"
                id="cheating"
                name="marks"
                class="form__input-box"
                required
              />

              <label for="content">Test link:*</label>
                <div class="u-flex">
                  <input
                id="text"
                name="question"
                class="form__textarea form__input-box"
                required
              ></text>
                  <button class="button" style="padding: 10px 15px; background-color: #1a7aaf; margin-left: 1.2rem; display: flex; color: #fff;">
                    Generate&#128279;
                  </button>
                </div>

              <div class="u-flex-col">
                <div class="u-flex" style="justify-content: flex"></div>
              </div>

              <div class="button-container-2">
                <button type="submit" class="add-button">Add</button>
                <button type="button" class="cancel-button" id="cancelAddExam">Cancel</button>
              </div>

              <h3 class="popup__title" style="margin: 3.5rem 0 1rem">
                Selected scetions
              </h3>

              <div
              id="innerGrid"
              class="popup__content"
              style="margin-top: 0.5rem"
            ></div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Grid  -->
    <div
      id="outerGrid__exam"
      style="margin-top: 1.5rem"
      class="grid categories__grid"
    ></div>

    <!-- //////////////////////////////////////////////////
    /////// -->

    <script>
      /////////////////////////////////////////////
      /// Table loading

      // Global Data Source
      let selectedRows = [];

      // 1. Outer grid
      function getOuterTable() {
        console.log("started");

        // Hard-coded categories
        const categoriesArray = [
          {
            cid: 1,
            sectionName: "Java Easy for Freshers",
            category_type: "Programming",
          },

          {
            cid: 2,
            sectionName: "Java Test for 2-year Ex",
            category_type: "Java",
          },

          {
            cid: 3,
            sectionName: "SQL Test for 2-year Ex",
            category_type: "SQL",
          },
        ];

        const dataSource1 = new kendo.data.DataSource({
          data: categoriesArray,
        });

        const mainContent = $("#outerGrid__exam");

        mainContent.empty();

        const gridDiv = $("<div id='grid'></div>");

        mainContent.append(gridDiv);

        gridDiv.kendoGrid({
          dataSource: dataSource1,
          height: 250,
          sortable: true,
          pageable: { pageSize: true },
          filterable: true,
          columns: [
            { field: "cid", title: "cid", width: "50px" },

            { field: "sectionName", title: "sectionName", width: "200px" },

            { field: "category_type", title: "Category Title", width: "200px" },

            {
              title: "Actions",
              template: `
                      <button class="k-button" onclick="loadquestionsSection(#: cid#)">ViewQuestions</button>
                            <button class="k-button" onclick="editCategory(#: cid#)">Edit</button>
                            <button class="k-button" onclick="deleteSection(#: cid#)">Delete</button>
            `,
              width: "200px",
            },
          ],
          footer: "Total: #= kendo.toString(sum, 'c') #",
        });
      }
      getOuterTable();

      // 2. Inner table fetch

      function getInnerTable() {
        // Hard-coded categories
        console.log(selectedRows);
        const dataSource1 = new kendo.data.DataSource({
          data: selectedRows,
        });

        console.log(selectedRows);
        console.log(dataSource1);

        const mainContent = $("#innerGrid ");

        mainContent.empty();

        const gridDiv = $("<div id='grid'></div>");

        mainContent.append(gridDiv);

        gridDiv.kendoGrid({
          dataSource: dataSource1,
          height: 250,
          sortable: true,
          pageable: { pageSize: true },
          filterable: true,
          columns: [
            { field: "questionId", title: "Question ID" },
            { field: "questionText", title: "Question Text" },
            {
              title: "Actions",
              template: `
                            <button class="k-button" onclick="deleteSection(#: questionId#)">Delete</button>
            `,
              width: "200px",
            },
          ],
          footer: "Total: #= kendo.toString(sum, 'c') #",
        });
      }

      function addSelectedQuestions() {
        // Get all selected checkboxes
        const selectedCheckboxes = $(".question-checkbox:checked"); // Extract and store selected question data
        selectedQuestions = [];
        selectedCheckboxes.each(function () {
          const row = $(this).closest("tr");
          const questionId = row.find("td:eq(1)").text();
          // Assuming the question ID is in the second column
          const questionText = row.find("td:eq(2)").text(); // Assuming the question text is in the third column        // Add the selected question to the array
          selectedRows.push({
            questionId: questionId,
            questionText: questionText, // Add other properties as needed
          });
        }); // Close the question popup
      }
      // 3. Inner table fetch

      getMidTable();

      function getMidTable() {
        const questions = [
          { questionId: 1, questionText: "What is 2 + 2?", difficulty: "Easy" },
          {
            questionId: 2,
            questionText: "What is the capital of France?",
            difficulty: "Medium",
          },
          {
            questionId: 3,
            questionText: "What is the square root of 16?",
            difficulty: "Easy",
          },
          {
            questionId: 4,
            questionText: "Who wrote the play 'Romeo and Juliet'?",
            difficulty: "Medium",
          },
          {
            questionId: 5,
            questionText:
              "In which year was the Declaration of Independence signed?",
            difficulty: "Hard",
          },
          // Add more questions as needed
        ];

        const mainContent = $("#midGrid__exam");
        mainContent.empty();

        const gridDiv = $("<div id='grid'></div>");
        mainContent.append(gridDiv);

        const dataSource1 = new kendo.data.DataSource({
          data: questions,
        });

        const grid = gridDiv
          .kendoGrid({
            dataSource: dataSource1,
            columns: [
              {
                title: "Select",
                template: '<input type="checkbox" class="question-checkbox" />',
                width: 60,
              },
              { field: "questionId", title: "Question ID" },
              { field: "questionText", title: "Question Text" },
              { field: "difficulty", title: "Difficulty" },
            ],
          })
          .data("kendoGrid");
      }

      function editCategory(cid) {
        let mainContent = $("#mainContentExam");
        mainContent.empty(); // Clear the main content

        let editCategoryForm = `
        <div class="form-container u-flex" style="margin: 3.5rem auto; position: relative">
          <div class="u-flex-col form__inner-container" style="width: 100%">
            <h1>Edit Exam</h1>

            <span id="closeEditCategory" class="popup__icon" style="float: right; cursor: pointer;">&times;</span>

            <form action="#" method="post" style: "position: absolute">
              <div
                class="u-flex"
                style="width: 35%; align-items: baseline; margin-top: 1rem"
              >
                <label
                  for="name"
                  style="
                    font-family: Inter;
                    font-size: 18px;
                    font-style: normal;
                    font-weight: 400;
                    line-height: 17.6px;
                  "
                  >Question name:</label
                >
                <label class="toggle" style="margin-bottom: -0.1px">
                  <input class="toggle-input" type="checkbox" />
                  <span class="toggle-label"></span>
                  <span class="toggle-handle"></span>
                </label>
              </div>

              <label for="negative__marking" style="margin-top: 1.8rem"
                >Negative marking:</label
              >
              <input
                type="number"
                id="negative__marking"
                name="marks"
                class="form__input-box"
                required
              />

              <label for="cheating"
                >Chances allowed if new tab opened / tab-switched:</label
              >
              <input
                type="number"
                id="cheating"
                name="marks"
                class="form__input-box"
                required
              />

              <label for="content">Test link:*</label>
              <textarea
                id="content"
                name="question"
                class="form__textarea"
                required
              ></textarea>

              <div class="u-flex-col">
                <div class="u-flex" style="justify-content: flex"></div>
              </div>

              <div class="button-container-2">
                <button type="submit" class="add-button">Add</button>
                <button type="button" class="cancel-button">Cancel</button>
              </div>
            </form>
          </div>
        </div>
    `;

        mainContent.append(editCategoryForm);

        // Add event listener to close the form when the "Close" icon is clicked
        $("#closeEditCategory").on("click", function () {
          mainContent.empty(); // Clear the form when closed
        });
      }

      /////////////////////////////////////////////
      /// Events handling

      const overlay__exams = document.getElementById("overlay__exams");
      const show__cards__exam = document.getElementById("show__cards__exam");
      const create__new__exam__section =
        document.getElementById("create__new__exam");
      const create__new__exam__button = document.getElementById(
        "create__new__exam__button"
      );
      const outerGrid__exam = document.getElementById("outerGrid__exam");
      const closeChoseOverlay__exam = document.getElementById(
        "closeChoseOverlay__exam"
      );
      const selectSection = document.getElementById("popup__button");
      const exam__content = document.getElementById("exam__content");
      const cancelAddExam = document.getElementById("cancelAddExam");
      
      // Cancel the create form
      cancelAddExam.addEventListener("click", () => {
        create__new__exam__section.classList.add("u-display-none");
        outerGrid__exam.classList.remove("u-display-none");
        getOuterTable();
      })

      // View all sections
      function loadquestionsSection(cid) {  
        overlay__exams.classList.remove("u-display-none");
      }

      // Add exam
      show__cards__exam.addEventListener("click", () => {
        getInnerTable();
        create__new__exam__section.classList.remove("u-display-none");
        outerGrid__exam.classList.add("u-display-none");
        selectSection.classList.remove("u-display-one");
      });

      // Add section
      create__new__exam__button.addEventListener("click", () => {
        overlay__exams.classList.remove("u-display-none");
      });

      // Close popup
      closeChoseOverlay__exam.addEventListener("click", () => {
        overlay__exams.classList.add("u-display-none");
      });
      
      // Close popup
      selectSection.addEventListener("click", () => {
        overlay__exams.classList.add("u-display-none");
        addSelectedQuestions();
        getInnerTable();
      });

    </script>

    <script src=".//js/components/questions.js"></script>
  </body>
</html>
