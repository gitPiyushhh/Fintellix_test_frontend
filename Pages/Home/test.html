<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Category Management</title>

    <!-- Icons -->
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&family=Open+Sans:ital,wght@0,300;0,400;0,500;1,300;1,600&display=swap"
      rel="stylesheet"
    />

    <!-- Kendo UI CSS -->

    <script type="text/javascript" src="lib/jquery.min.js"></script>

    <script type="text/javascript" src="lib/jquery.js"></script>
    <script src=".//js/components/questions.js"></script>

    <!-- <script type="text/javascript" src="lib/select2.js"></script> -->

    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="lib/jquery-ui.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="lib/jquery-ui.min.css"
    />

    <!--Kendo-->

    <link
      rel="stylesheet"
      type="text/css"
      href="lib/kendo.default-v2.min.css"
    />

    <script type="text/javascript" src="./lib/kendo.all.min.js"></script>

    <link
      rel="stylesheet"
      type="text/css"
      href="css\font-awesome-4.7.0\css\font-awesome.min.css"
    />

    <!-- <link rel="stylesheet" type="text/css" href="css/font-awesome.css" />  -->

    <link rel="stylesheet" href="./css/addQuestion.css" />
    <link rel="stylesheet" href="./css/createUser.css" />
    <link rel="stylesheet" href="./css/navbar.css" />
    <link rel="stylesheet" href="./css/ulitlities.css" />
    <link rel="stylesheet" href="./css/form.css" />
    <link rel="stylesheet" href="./css/popup.css" />
    <link rel="stylesheet" href="./css/scrollbar.css" />

    <script type="text/javascript" src="questionSection.js"></script>
  </head>
  <body>
    <div class="overlay u-display-none" id="categories__overlay">
      <div
        id="questionPopup"
        class="popup"
        style="transform: translateY(-15px)"
      >
        <div class="popup__content">
          <span
            id="closeChoseOverlay"
            class="popup__icon"
            style="float: right; cursor: pointer"
            >&times;</span
          >

          <h3 class="popup__title">Available categories</h3>

          <div id="midGrid" class="popup__content"></div>
        </div>
      </div>
    </div>

    <nav class="navbar">
      <ul class="u-flex">
        <a class="logo" href="./index.html" style="cursor: pointer">
          <img
            src="./../../Drawables/FIntellix Logo.svg"
            alt="Website logo"
            class="navbar__logo"
          />
        </a>
        <div class="u-flex">
          <li class="dropdown">
            <a href="#" class="dropbtn">Home</a>
          </li>
          <li class="dropdown">
            <a href="./questions.html" class="dropbtn">Questions</a>
          </li>
          <li class="dropdown">
            <a href="./categories.html" class="dropbtn">Categories</a>
          </li>
          <li>
            <a href="#" class="dropbtn" style="text-decoration: none"
              >Analytics</a
            >
          </li>

          <li>
            <a href="#" class="dropbtn" style="text-decoration: none"
              >Certifications</a
            >
          </li>

          <li>
            <a href="./user.html" class="dropbtn" style="text-decoration: none"
              >Users</a
            >
          </li>

          <li class="userAvatar" style="margin-left: 1rem"></li>
        </div>
      </ul>
    </nav>

    <div class="user__button">
      <div class="user__button-inner" style="justify-content: flex-end">
        <a
          class="button u-flex"
          style="
            background-color: #1a7aaf;
            justify-self: flex-end;
            padding: 0.75rem 1.5rem;
            margin-top: 0.5rem;
          "
          href="#"
          id="category__form__display"
        >
          Add Section
          <iconify-icon
            icon="zondicons:add-outline"
            style="margin-left: 8px"
          ></iconify-icon>
        </a>
      </div>
    </div>

    <div id="mainContent">
    </div>

    <!-- Form -->
    <div
      class="wrapper u-display-none"
      id="add__category__form__popup"
      style="margin-top: 2rem"
    >
      <div
        class="form-container u-flex"
        style="height: 80%; position: relative"
      >
        <div class="u-flex-col form__inner-container" style="width: 100%">
          <h1>Create section</h1>
          <span
            id="formCloseBtn"
            class="popup__icon"
            style="float: right; cursor: pointer"
            >&times;</span
          >

          <form action="#" method="post">
            <label for="name">Section name:*</label>
            <input
              type="text"
              id="name"
              name="name"
              class="form__input-box"
              required
            />

            <label for="category">Categories type:*</label>
            <select
              id="category"
              class="form__input-box"
              style="font-size: 14px; color: #565656; padding-right: 1rem"
            >
              <option disabled selected value="">Select from options</option>
              <option value="easy">Programming</option>
              <option value="medium">Logical</option>
              <option value="hard">Aptitude</option>
            </select>

            <label for="time">Time limit (in minutes):</label>
            <input
              type="number"
              id="time"
              name="email"
              class="form__input-box"
              required
            />

            <label for="time">Pass percentage:</label>
            <input
              type="number"
              id="time"
              name="email"
              class="form__input-box"
              required
            />

            <div class="button-container-2" style="flex-wrap: wrap">
              <button
                type="button"
                id="openMidGridBtn"
                class="button"
                style="
                  width: 47%;
                  background-color: #e1dddd55;
                  border: 0.4px solid #1a7aaf;
                  color: #000;
                  margin-top: 1rem;
                "
              >
                Choose from Questions
              </button>
            </div>

            <h3 class="popup__title" style="margin: 1rem 0 1rem">
              Selected categories
            </h3>

            <div
              id="innerGrid"
              class="popup__content"
              style="margin-top: 0.5rem"
            ></div>

            <div
              class="button-container-2"
              style="flex-wrap: wrap; margin-top: 3rem"
            >
              <button type="submit" class="button" style="width: 47%">
                Add
              </button>
              <button
                type="button"
                class="button"
                style="width: 47%; background-color: #e1dddd; color: #000"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- <div
      class="wrapper u-display-none"
      style="margin-top: 3rem"
      id="categories__main-content"
    >
      <div class="form-container u-flex" style="position: relative">
        <div
          class="u-flex-col form__inner-container"
          style="width: 100%; margin-top: 2rem"
        >
          <h1>Create section</h1>
          <span
            id="closeMainContent"
            class="popup__icon"
            style="float: right; cursor: pointer"
            >&times;</span
          >

          <form action="#" method="post">
            <label for="name">Section name:*</label>
            <input
              type="text"
              id="name"
              name="name"
              class="form__input-box"
              required
            />

            <label for="category">Categories type:*</label>
            <select
              id="category"
              class="form__input-box"
              style="font-size: 14px; color: #565656; padding-right: 1rem"
            >
              <option disabled selected value="">Select from options</option>
              <option value="easy">Programming</option>
              <option value="medium">Logical</option>
              <option value="hard">Aptitude</option>
            </select>

            <label for="time">Time limit (in minutes):</label>
            <input
              type="number"
              id="time"
              name="email"
              class="form__input-box"
              required
            />

            <label for="time">Pass percentage:</label>
            <input
              type="number"
              id="time"
              name="email"
              class="form__input-box"
              required
            />

            <div class="button-container-2">
              <button type="submit" class="add-button">Add</button>
              <button type="button" class="cancel-button">Cancel</button>
            </div>

            <div class="button-container-2">
              <a
                type="button"
                class="add-button"
                style="text-align: center; width: 35%"
                onclick="openQuestionPopup1()"
                id="addQuestionGridElem"
                >Select questions</a
              >
            </div>

            <h3 class="popup__title">Questions</h3>
            <div id="addQuestionsGridCustom" class=""></div>
          </form>
        </div>
      </div>
    </div> -->

    <!-- Grid  -->
    <div
      id="outerGrid"
      style="margin-top: 1.5rem"
      class="grid categories__grid"
    ></div>

    <!-- //////////////////////////////////////////////////
    /////// -->

    <script>
      /////////////////////////////////////////////
      /// Table loading

      // Global Data Source
      let selectedRows = [];

      // 1. Outer grid
      function getOuterTable() {
        console.log("started");

        // Hard-coded categories
        const categoriesArray = [
          {
            cid: 1,
            sectionName: "Java Easy for Freshers",
            category_type: "Programming",
          },

          {
            cid: 2,
            sectionName: "Java Test for 2-year Ex",
            category_type: "Java",
          },

          {
            cid: 3,
            sectionName: "SQL Test for 2-year Ex",
            category_type: "SQL",
          },
        ];

        const dataSource1 = new kendo.data.DataSource({
          data: categoriesArray,
        });

        const mainContent = $("#outerGrid ");

        mainContent.empty();

        const gridDiv = $("<div id='grid'></div>");

        mainContent.append(gridDiv);

        gridDiv.kendoGrid({
          dataSource: dataSource1,
          height: 250,
          sortable: true,
          pageable: { pageSize: true },
          filterable: true,
          columns: [
            { field: "cid", title: "cid", width: "50px" },

            { field: "sectionName", title: "sectionName", width: "200px" },

            { field: "category_type", title: "Category Title", width: "200px" },

            {
              title: "Actions",
              template: `
                      <button class="k-button" onclick="loadquestionsSection(#: cid#)">ViewQuestions</button>
                            <button class="k-button" onclick="editCategory(#: cid#)">Edit</button>
                            <button class="k-button" onclick="deleteSection(#: cid#)">Delete</button>
            `,
              width: "200px",
            },
          ],
          footer: "Total: #= kendo.toString(sum, 'c') #",
        });
      }
      getOuterTable();

      // 2. Inner table fetch

      function getInnerTable() {
        // Hard-coded categories

        const dataSource1 = new kendo.data.DataSource({
          data: selectedRows,
        });

        console.log(selectedRows);
        console.log(dataSource1);

        const mainContent = $("#innerGrid ");

        mainContent.empty();

        const gridDiv = $("<div id='grid'></div>");

        mainContent.append(gridDiv);

        gridDiv.kendoGrid({
          dataSource: selectedRows,
          height: 250,
          sortable: true,
          pageable: { pageSize: true },
          filterable: true,
          columns: [
            { field: "questionId", title: "Question ID" },
            { field: "questionText", title: "Question Text" },
            {
              title: "Actions",
              template: `
                            <button class="k-button" onclick="deleteSection(#: questionId#)">Delete</button>
            `,
              width: "200px",
            },
          ],
          footer: "Total: #= kendo.toString(sum, 'c') #",
        });
      }

      function addSelectedQuestions() {
        // Get all selected checkboxes
        const selectedCheckboxes = $(".question-checkbox:checked"); // Extract and store selected question data
        selectedQuestions = [];
        selectedCheckboxes.each(function () {
          const row = $(this).closest("tr");
          const questionId = row.find("td:eq(1)").text();
          // Assuming the question ID is in the second column
          const questionText = row.find("td:eq(2)").text(); // Assuming the question text is in the third column        // Add the selected question to the array
          selectedRows.push({
            questionId: questionId,
            questionText: questionText, // Add other properties as needed
          });
        }); // Close the question popup
      }
      // 3. Inner table fetch

      function getMidTable() {
        const questions = [
          { questionId: 1, questionText: "What is 2 + 2?", difficulty: "Easy" },
          {
            questionId: 2,
            questionText: "What is the capital of France?",
            difficulty: "Medium",
          },
          {
            questionId: 3,
            questionText: "What is the square root of 16?",
            difficulty: "Easy",
          },
          {
            questionId: 4,
            questionText: "Who wrote the play 'Romeo and Juliet'?",
            difficulty: "Medium",
          },
          {
            questionId: 5,
            questionText:
              "In which year was the Declaration of Independence signed?",
            difficulty: "Hard",
          },
          // Add more questions as needed
        ];

        const mainContent = $("#midGrid");
        mainContent.empty();

        const gridDiv = $("<div id='grid'></div>");
        mainContent.append(gridDiv);

        const dataSource1 = new kendo.data.DataSource({
          data: questions,
        });

        const grid = gridDiv
          .kendoGrid({
            dataSource: dataSource1,
            columns: [
              {
                title: "Select",
                template: '<input type="checkbox" class="question-checkbox" />',
                width: 60,
              },
              { field: "questionId", title: "Question ID" },
              { field: "questionText", title: "Question Text" },
              { field: "difficulty", title: "Difficulty" },
            ],
          })
          .data("kendoGrid");
      }

      function editCategory(cid) {

        let mainContent = $("#mainContent");
        mainContent.empty(); // Clear the main content

        let editCategoryForm = `
        <div class="form-container u-flex" style="height: 80%; position: relative;">
        <div class="u-flex-col form__inner-container" style="width: 100%;">
        <h1>Edit Category</h1>
        <span id="closeEditCategory" class="popup__icon" style="float: right; cursor: pointer;">&times;</span>
        <form action="#" method="post">
        <label for="name">Category Name:*</label>
        <input type="text" id="name" name="name" class="form__input-box" required />
        <label for="categoryType">Category Type:*</label>
        <select id="categoryType" class="form__input-box" style="font-size: 14px; color: #565656; padding-right: 1rem;">
        <option disabled selected value="">Select from options</option>
        <option value="Programming">Programming</option>
        <option value="Logical">Logical</option>
        <option value="Aptitude">Aptitude</option>
        </select>
        <label for="time">Time limit (in minutes):</label>
        <input type="number" id="time" name="email" class="form__input-box" required />
        <label for="passPercentage">Pass percentage:</label>
        <input type="number" id="passPercentage" name="email" class="form__input-box" required />
        <div class="button-container-2">
        <button type="submit" class="add-button">Save</button>
        <button type="button" class="cancel-button">Cancel</button>
        </div>
        </form>
        </div>
        </div>
    `;

        mainContent.append(editCategoryForm);

        // Add event listener to close the form when the "Close" icon is clicked
        $("#closeEditCategory").on("click", function () {
          mainContent.empty(); // Clear the form when closed
        });
      }
      $("#editCategoryButton").on("click", function () {
        loadEditCategoryForm();
      });
      /////////////////////////////////////////////
      /// Events handling
      const formDisplayBtn = document.getElementById("category__form__display");
      const formCloseBtn = document.getElementById("formCloseBtn");
      const openMidGridBtn = document.getElementById("openMidGridBtn");
      const closeChoseOverlay = document.getElementById("closeChoseOverlay");

      const categories__overlay = document.getElementById(
        "categories__overlay"
      );
      const outerGrid = document.getElementById("outerGrid");
      const add__category__form__popup = document.getElementById(
        "add__category__form__popup"
      );

      formDisplayBtn.addEventListener("click", () => {
        outerGrid.classList.add("u-display-none");
        add__category__form__popup.classList.remove("u-display-none");
        getInnerTable();
      });

      formCloseBtn.addEventListener("click", () => {
        outerGrid.classList.remove("u-display-none");
        add__category__form__popup.classList.add("u-display-none");
      });

      openMidGridBtn.addEventListener("click", () => {
        outerGrid.classList.add("u-display-none");
        add__category__form__popup.classList.add("u-display-none");
        categories__overlay.classList.remove("u-display-none");
        getMidTable();
      });

      closeChoseOverlay.addEventListener("click", () => {
        add__category__form__popup.classList.remove("u-display-none");
        categories__overlay.classList.add("u-display-none");
        console.log("Heree: " + selectedRows);
        addSelectedQuestions();
        getInnerTable();
      });
    </script>

    <script src=".//js/components/questions.js"></script>
  </body>
</html>
